<main>

    <div class="entregas-container">

        <!-- Header con título e icono  -->
        <div class="title">
            <div class="title-icon">
                <img src="/icons/bi-pencil.svg" alt="Icono de Actividades" />
                <h1>Mis Actividades</h1>
            </div>
        </div>

        <!-- Campo de búsqueda manual  -->
        <div class="search-section">
            <div class="search-input-group">
                <input type="text" class="form-control" placeholder="Buscar por título o descripción..."
                    (input)="aplicarFiltroTexto($any($event.target).value)">
                <i class="fas fa-search search-icon"></i>
            </div>
        </div>

        <!-- Filtros de materias y actividades -->
        <div class="filters-and-actions-container">
            <app-filters [filters]="filterConfigs" [showMobileVersion]="true" mobileCollapseId="entregasFilters"
                (filterChange)="onFilterChange($event)" (buttonClick)="onFilterButtonClick($event)">
            </app-filters>
            <div class="action-buttons">
                <!-- No hay acciones por ahora en la vista de actividades del alumno -->
            </div>
        </div>

        <!-- Loading state y datos reactivos -->
        <div *ngIf="loading$ | async" class="loading-container">
            <div class="spinner"></div>
            <p>Cargando actividades...</p>
        </div>

        <section class="table-container" *ngIf="!(loading$ | async)">
            <div *ngIf="actividadesFiltradas$ | async as actividades">
                <app-generic-table [columns]="tableColumns" [data]="actividades" [actions]="tableActions" [striped]="true"
                    [hover]="true" [loading]="false" tableClasses="tabla-genérica"
                    emptyMessage="No hay actividades disponibles" (sort)="onTableSort($event)"
                    (rowClick)="onTableRowClick($event)" (actionClick)="onTableAction($event)">
                </app-generic-table>
            </div>
        </section>

        <!-- Modal de Detalles de Actividad -->
        <div class="modal-overlay" *ngIf="showDetalleModal$ | async">
            <div class="modal-container">
                <div class="modal-header">
                    <h3>
                        {{ (selectedActividad$ | async)?.titulo || 'Detalle de actividad' }}
                    </h3>
                    <button class="btn-close" (click)="cerrarDetalleModal()" aria-label="Cerrar">✕</button>
                </div>
                <div class="modal-body">
                    <ng-container *ngIf="selectedActividad$ | async as act">
                        <div class="form-group">
                            <label>Materia</label>
                            <div class="form-control" style="background:#f9fafb">{{ act.materia_nombre }}</div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Tipo</label>
                                <div class="form-control" style="background:#f9fafb">{{ act.tipo }}</div>
                            </div>
                            <div class="form-group">
                                <label>Fecha límite</label>
                                <div class="form-control" style="background:#f9fafb">{{ act.fechaLimite }}</div>
                            </div>
                            <div class="form-group">
                                <label>Puntos</label>
                                <div class="form-control" style="background:#f9fafb">{{ act.puntos }}</div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Estado</label>
                            <div class="form-control" style="background:#f9fafb">{{ act.estado }}</div>
                        </div>
                        <div class="form-group">
                            <label>Descripción</label>
                            <div class="form-control" style="white-space: pre-wrap; min-height: 80px; background:#fff">{{ act.descripcion }}</div>
                        </div>
                        <div class="form-group" *ngIf="act.instrucciones">
                            <label>Instrucciones</label>
                            <div class="form-control" style="white-space: pre-wrap; min-height: 80px; background:#fff">{{ act.instrucciones }}</div>
                        </div>
                    </ng-container>
                </div>
                <div class="modal-footer">
                    <button class="btn-secondary" (click)="cerrarDetalleModal()">Cerrar</button>
                </div>
            </div>
        </div>


        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    </div>
</main>