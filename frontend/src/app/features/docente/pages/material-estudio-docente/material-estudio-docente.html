<div class="material-estudio-container">
  <!-- Header con titulo y boton crear -->
  <div class="header">
    <div>
      <h2 class="title">Material de Estudio</h2>
      @if (materiaSeleccionada) {
        <p class="subtitle">{{ materiaSeleccionada.nombre }}</p>
      }
    </div>
    <button class="btn-primary" (click)="abrirModalCrear()" [disabled]="!materiaSeleccionada">
      Agregar Material
    </button>
  </div>

  <!-- Mensajes de estado -->
  @if (successMessage) {
    <div class="alert alert-success">{{ successMessage }}</div>
  }

  @if (error) {
    <div class="alert alert-error">{{ error }}</div>
  }

  <!-- Estado de carga -->
  @if (loading) {
    <div class="loading-container">
      <div class="spinner"></div>
      <p>Cargando materiales...</p>
    </div>
  }

  <!-- Lista vacia -->
  @if (!loading && materiales.length === 0) {
    <div class="empty-state">
      <p>No hay materiales de estudio disponibles</p>
      @if (materiaSeleccionada) {
        <button class="btn-secondary" (click)="abrirModalCrear()">
          Crear el primer material
        </button>
      } @else {
        <p class="hint">Selecciona una materia para ver sus materiales</p>
      }
    </div>
  }

  <!-- Tabla de materiales -->
  @if (!loading && materiales.length > 0) {
    <div class="table-container">
      <table class="material-table">
        <thead>
          <tr>
            <th>Título</th>
            <th>Descripción</th>
            <th>Enlace</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          @for (material of materiales; track material.id) {
            <tr>
              <td class="col-titulo">{{ material.titulo }}</td>
              <td class="col-descripcion">{{ material.descripcion }}</td>
              <td class="col-url">
                <a [href]="obtenerUrlArchivo(material.archivo)" target="_blank" class="link-url">
                  Ver archivo
                </a>
              </td>
              <td class="col-acciones">
                <div class="action-buttons">
                  <button 
                    class="btn-icon btn-edit" 
                    (click)="abrirModalEditar(material)"
                    title="Editar material">
                    Editar
                  </button>
                  <button 
                    class="btn-icon btn-delete" 
                    (click)="eliminarMaterial(material)"
                    title="Eliminar material">
                    Eliminar
                  </button>
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }

  <!-- Modal para crear/editar material -->
  @if (mostrarModal) {
    <div class="modal-overlay" (click)="cerrarModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>{{ modoEdicion ? 'Editar Material' : 'Nuevo Material' }}</h3>
          <button class="btn-close" (click)="cerrarModal()">×</button>
        </div>

        <form class="modal-body" (ngSubmit)="guardarMaterial()">
          <div class="form-group">
            <label for="titulo">Título *</label>
            <input 
              type="text" 
              id="titulo"
              [(ngModel)]="formulario.titulo"
              name="titulo"
              placeholder="Ej: Guía de Introducción a Angular"
              required
              maxlength="200"
            />
          </div>

          <div class="form-group">
            <label for="descripcion">Descripción *</label>
            <textarea 
              id="descripcion"
              [(ngModel)]="formulario.descripcion"
              name="descripcion"
              placeholder="Describe el contenido del material..."
              rows="4"
              required
              maxlength="500"
            ></textarea>
          </div>

          <div class="form-group">
            <label for="archivo">
              Archivo {{ modoEdicion ? '' : '*' }}
            </label>
            
            @if (modoEdicion && nombreArchivoActual) {
              <div class="archivo-actual">
                <span>Archivo actual: <strong>{{ nombreArchivoActual }}</strong></span>
                <small class="form-hint">Sube un nuevo archivo solo si deseas reemplazarlo</small>
              </div>
            }
            
            <div class="file-input-wrapper">
              <input 
                type="file" 
                id="archivo"
                (change)="onArchivoSeleccionado($event)"
                accept=".pdf,.doc,.docx,.ppt,.pptx,.txt,.zip"
                class="file-input"
              />
              <label for="archivo" class="file-label">
                {{ archivoSeleccionado ? archivoSeleccionado.name : 'Seleccionar archivo' }}
              </label>
            </div>
            
            <small class="form-hint">
              Formatos permitidos: PDF, Word, PowerPoint, TXT, ZIP (máx. 10MB)
            </small>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn-secondary" (click)="cerrarModal()">
              Cancelar
            </button>
            <button type="submit" class="btn-primary" [disabled]="loading">
              {{ modoEdicion ? 'Actualizar' : 'Crear' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  }
</div>